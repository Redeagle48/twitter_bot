var Bot = require("./bot")
, config1 = require("../config1");

var bot = new Bot(config1);

console.log('OutSystemsBot: Running...');

//get date string for today's date (e.g. 2011-01-01)
function datestring () {
    var d = new Date(Date.now() - 5*60*60*1000); //est timezone
    return d.getUTCFullYear() + "-" +
        (d.getUTCMonth() + 1) + "-" +
        d.getDate();
};

setInterval(function() {

    // Generate random number
    var rand = Math.random();

    //
    // What to do??
    //
    
    // do a targeted follow
    if(rand <= .25) {  
        var params = {
            q: "developer or outsystems or outsystems developer"
            , since: datestring()
            , result_type: "mixed"
        };

        bot.searchFollow(params, function(err, reply) {
            if(err) return handleError(err);

            var name = reply.screen_name;
            console.log("\nSearchFollow: followed @" + name);
        });
    }
    
    // retweet
    else if(rand <= .60) {  
        var params = {
            q: "consultor outsystems OR emprego outsystems OR jobs outsystems OR consultant outsystems OR or outsystems developer"
            , since: datestring()
            , result_type: "mixed"
        };

        bot.retweet(params, function(err, reply) {
            if(err) return handleError(err);

            console.log("\nRetweet: retweeted response: " + reply.id);
        });
    } 
    
    // favorite
    else if(rand <= 1) {  
        var params = {
            q: "consultor outsystems OR emprego outsystems OR jobs outsystems OR consultant outsystems OR or outsystems developer"
            , since: datestring()
            , result_type: "mixed"
        };

        bot.favorite(params, function(err, reply) {
            if(err) return handleError(err);

            console.log("\nFavorite: favorited response: " + reply.id);
        });
    }
}, 4000);

function handleError(err) {
    console.error("response status:", err.statusCode);
    console.error("data:", err.data);
}